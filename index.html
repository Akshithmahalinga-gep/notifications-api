<!DOCTYPE html>
<html>
<head>
    <title>My First Node App</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
    <script src="https://js.pusher.com/7.0/pusher.min.js"></script>

</head>
<body>
    <div class="container">
        <br>
        <div class="jumbotron">
            <h1 class="display-4">Send Notification</h1>
            <br>
            <input id="title" class="form-control" placeholder="Title">
            <br>
            <textarea id="body" class="form-control" placeholder="Notification"></textarea>
            <br>
            <input id="tag" class="form-control" placeholder="tag">
            <div class="form-control" style="margin-top: 10px;">
            <label for="usertype">Select Recepients</label>
            <select name="usertype" id="usertype">
              <option value="Supplier">Supplier</option>
              <option value="Buyer">Buyer</option>
            </select>
            </div>
            <div class="form-control" style="margin-top: 10px">
            <label for="isAnnouncement">Send as an Announcement?</label>
            <input type="checkbox" name="isAnnouncement" id="isAnnouncement">
            </div>
            <button id="send" onclick="addNotification()" class="btn btn-success" style="margin: 5px">Send</button>
        </div>
    </div>
    <script>
        function addNotification() {
            var notification = {};
            notification.title = $("#title").val();
            notification.body = $("#body").val();
            notification.tag = $("#tag").val();
            notification.usertype = $("#usertype").val();
            notification.isAnnouncement = $("#isAnnouncement").is(":checked");
          //  notification.date = $("#tag").val();
           $.ajax({
            type: "POST",
            url: "https://notification-backend-techathon.herokuapp.com/create-notification",
            data: notification
           }).then(alert(`notification sent`));
        }
        // var socket = io();
        // $(() => {
        //     $("#send").click(() => {
        //         sendMessage({ name: $("#name").val(), message: $("#message").val() });
        //     })
        // })

        // socket.on('message', addMessages)

        // function addMessages(message) {
        //     $("#messages").append(`<h4> ${message.name} </h4> <p> ${message.message} </p>`)
        // }

        // function getNotifications() {
        //     $.get('http://localhost:3000/notifications', (data) => {
        //         data.forEach(addMessages);
        //     })
        // }

        // function sendMessage(message) {
        //     $.post('http://localhost:3000/messages', message)
        // }
    Pusher.logToConsole = true;

    var pusher = new Pusher('c6bf459ca09940fc7c8b', {
      cluster: 'ap2'
    });

    var supplierChannel = pusher.subscribe('Supplier');
    supplierChannel.unbind('my-event');
    supplierChannel.bind('notification', function(data) {
      alert(JSON.stringify(data));
    });

    var buyerChannel = pusher.subscribe('Buyer');
    supplierChannel.unbind('my-event')
    buyerChannel.bind('notification', function(data) {
      alert(JSON.stringify(data));
    });


    var announcementsChannel = pusher.subscribe('Announcements');
    announcementsChannel.unbind('my-event');
    announcementsChannel.bind('announcement', function(data) {
      alert(JSON.stringify(data));
    }) 
    </script>
</body>
</html>
